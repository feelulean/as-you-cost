<dom-module id="ms-raise-rate">
    <template>
        <!-- ============================================================
             Ajax 선언부 — 인상율
             ============================================================ -->
        <sc-ajax id="findListAjax"
                 url="/bp/master/data/findListRaiseRate.do"
                 body="{{searchParam}}"
                 on-response="onFindListResponse">
        </sc-ajax>
        <sc-ajax id="saveListAjax"
                 url="/bp/master/data/saveListRaiseRate.do"
                 body="{{saveParam}}"
                 on-response="onSaveListResponse">
        </sc-ajax>
        <sc-ajax id="deleteListAjax"
                 url="/bp/master/data/deleteListRaiseRate.do"
                 body="{{deleteParam}}"
                 on-response="onDeleteListResponse">
        </sc-ajax>

        <!-- ============================================================
             조회 조건 영역
             ============================================================ -->
        <sc-search-container on-search="onFindList">
            <table>
                <colgroup>
                    <col style="width:120px"/>
                    <col/>
                    <col style="width:120px"/>
                    <col/>
                </colgroup>
                <tr>
                    <th><sc-label text="적용년도"></sc-label></th>
                    <td>
                        <sc-text-field value="{{searchParam.applyYear}}"
                                       on-enter="onFindList"
                                       placeholder="적용년도">
                        </sc-text-field>
                    </td>
                    <th><sc-label text="법인"></sc-label></th>
                    <td>
                        <sc-text-field value="{{searchParam.corpCd}}"
                                       on-enter="onFindList"
                                       placeholder="법인">
                        </sc-text-field>
                    </td>
                </tr>
                <tr>
                    <th><sc-label text="공장"></sc-label></th>
                    <td>
                        <sc-text-field value="{{searchParam.plantCd}}"
                                       on-enter="onFindList"
                                       placeholder="공장">
                        </sc-text-field>
                    </td>
                    <th><sc-label text="항목"></sc-label></th>
                    <td>
                        <sc-text-field value="{{searchParam.itemCd}}"
                                       on-enter="onFindList"
                                       placeholder="항목">
                        </sc-text-field>
                    </td>
                </tr>
            </table>
        </sc-search-container>

        <!-- ============================================================
             데이터 그리드 — 인상율 관리
             ============================================================ -->
        <sc-grid id="gridPanel"
                 data-provider="{{resultList}}"
                 editable="true"
                 class="flex">

            <sc-toolbar>
                <sc-button text="조회" on-click="onFindList"></sc-button>
                <sc-button text="추가" on-click="onAddRow"></sc-button>
                <span class="vt-seperator"></span>
                <sc-button text="삭제" on-click="onDeleteList"></sc-button>
                <sc-button text="저장" on-click="onSaveList"></sc-button>
            </sc-toolbar>

            <sc-grid-columns>
                <sc-data-column data-field="applyYear"
                                header-text="적용년도"
                                width="100"
                                editable="true"
                                text-align="center">
                </sc-data-column>
                <sc-data-column data-field="corpCd"
                                header-text="법인"
                                width="120"
                                editable="true"
                                text-align="center">
                </sc-data-column>
                <sc-data-column data-field="plantCd"
                                header-text="공장"
                                width="120"
                                editable="true"
                                text-align="center">
                </sc-data-column>
                <sc-data-column data-field="itemCd"
                                header-text="항목"
                                width="120"
                                editable="true"
                                text-align="center">
                </sc-data-column>
                <sc-data-column data-field="raiseRate"
                                header-text="인상율(%)"
                                width="120"
                                editable="true"
                                text-align="right"
                                data-type="number">
                </sc-data-column>
            </sc-grid-columns>
        </sc-grid>
    </template>

    <script>
        Polymer({
            is: 'ms-raise-rate',

            properties: {
                searchParam:  { type: Object, value: function() { return {}; } },
                resultList:   { type: Array,  value: function() { return []; } },
                saveParam:    { type: Object, value: function() { return {}; } },
                deleteParam:  { type: Object, value: function() { return {}; } }
            },

            attached: function() { this.onFindList(); },

            /* ── 조회 ── */
            onFindList: function() {
                this.$.findListAjax.generateRequest();
            },

            onFindListResponse: function(e) {
                this.set('resultList', e.detail.response);
            },

            /* ── 추가 ── */
            onAddRow: function() {
                this.$.gridPanel.addRow({
                    applyYear: '', corpCd: '', plantCd: '', itemCd: '', raiseRate: 0,
                    _rowStatus: 'C'
                });
            },

            /* ── 저장 ── */
            onSaveList: function() {
                var grid = this.$.gridPanel;
                var modifiedRows = grid.getModifiedRows();
                if (!modifiedRows || modifiedRows.length === 0) {
                    UT.alert('MSG_COM_00006');
                    return;
                }
                var me = this;
                UT.confirm('MSG_COM_00002', function() {
                    me.set('saveParam', { saveList: modifiedRows });
                    me.$.saveListAjax.generateRequest();
                });
            },

            onSaveListResponse: function() {
                UT.alert('MSG_COM_00003');
                this.onFindList();
            },

            /* ── 삭제 ── */
            onDeleteList: function() {
                var grid = this.$.gridPanel;
                var selectedRows = grid.getSelectedRows();
                if (!selectedRows || selectedRows.length === 0) {
                    UT.alert('MSG_COM_00007');
                    return;
                }
                var me = this;
                UT.confirm('MSG_COM_00004', function() {
                    me.set('deleteParam', { deleteList: selectedRows });
                    me.$.deleteListAjax.generateRequest();
                });
            },

            onDeleteListResponse: function() {
                UT.alert('MSG_COM_00005');
                this.onFindList();
            }
        });
    </script>
</dom-module>
