<dom-module id="es-ec-detail">
    <template>
        <style>
            :host {
                display: flex;
                flex-direction: column;
                height: 100%;
            }
            .tab-bar {
                display: flex;
                gap: 2px;
                border-bottom: 2px solid #6954FE;
                margin-bottom: 8px;
            }
            .tab-btn {
                padding: 8px 16px;
                border: none;
                background: #f0f1f5;
                cursor: pointer;
                font-size: 12px;
                border-radius: 4px 4px 0 0;
                white-space: nowrap;
            }
            .tab-btn:hover {
                background: #e0e1e8;
            }
            .tab-btn.active {
                background: #6954FE;
                color: #fff;
                font-weight: 600;
            }
            .detail-form-table {
                width: 100%;
                border-collapse: collapse;
            }
            .detail-form-table th {
                background: #f7f8fa;
                padding: 6px 10px;
                text-align: right;
                font-weight: 500;
                font-size: 12px;
                color: #555;
                border: 1px solid #e0e0e0;
                white-space: nowrap;
            }
            .detail-form-table td {
                padding: 4px 8px;
                border: 1px solid #e0e0e0;
            }
            .section-title {
                font-size: 13px;
                font-weight: 600;
                color: #333;
                padding: 8px 0 4px 0;
                border-bottom: 1px solid #ddd;
                margin-bottom: 8px;
            }
        </style>

        <!-- ============================================================
             Ajax 선언부
             ============================================================ -->

        <!-- 프로젝트 목록 조회 -->
        <sc-ajax id="findPjtListAjax"
                 url="/bp/cost/ec/findListEstimateCostPjt.do"
                 body="{{searchParam}}"
                 on-response="onFindPjtListResponse">
        </sc-ajax>

        <!-- 상세정보 조회 -->
        <sc-ajax id="findDetailAjax"
                 url="/bp/cost/ec/detail/findEcDetail.do"
                 body="{{detailSearchParam}}"
                 on-response="onFindDetailResponse">
        </sc-ajax>

        <!-- 상세정보 저장 -->
        <sc-ajax id="saveDetailAjax"
                 url="/bp/cost/ec/detail/saveEcDetail.do"
                 body="{{saveDetailParam}}"
                 on-response="onSaveDetailResponse">
        </sc-ajax>

        <!-- 원가코드/판가 조회 -->
        <sc-ajax id="findCostCodeAjax"
                 url="/bp/cost/ec/detail/findListCostCode.do"
                 body="{{detailSearchParam}}"
                 on-response="onFindCostCodeResponse">
        </sc-ajax>

        <!-- 원가코드/판가 저장 -->
        <sc-ajax id="saveCostCodeAjax"
                 url="/bp/cost/ec/detail/saveListCostCode.do"
                 body="{{saveCostCodeParam}}"
                 on-response="onSaveCostCodeResponse">
        </sc-ajax>

        <!-- 수량/할인율 조회 -->
        <sc-ajax id="findQtyDiscAjax"
                 url="/bp/cost/ec/detail/findListQtyDisc.do"
                 body="{{detailSearchParam}}"
                 on-response="onFindQtyDiscResponse">
        </sc-ajax>

        <!-- 수량/할인율 저장 -->
        <sc-ajax id="saveQtyDiscAjax"
                 url="/bp/cost/ec/detail/saveListQtyDisc.do"
                 body="{{saveQtyDiscParam}}"
                 on-response="onSaveQtyDiscResponse">
        </sc-ajax>

        <!-- 담당자 조회 -->
        <sc-ajax id="findManagerAjax"
                 url="/bp/cost/ec/detail/findListManager.do"
                 body="{{detailSearchParam}}"
                 on-response="onFindManagerResponse">
        </sc-ajax>

        <!-- 담당자 저장 -->
        <sc-ajax id="saveManagerAjax"
                 url="/bp/cost/ec/detail/saveListManager.do"
                 body="{{saveManagerParam}}"
                 on-response="onSaveManagerResponse">
        </sc-ajax>

        <!-- 일정 조회 -->
        <sc-ajax id="findScheduleAjax"
                 url="/bp/cost/ec/detail/findListSchedule.do"
                 body="{{detailSearchParam}}"
                 on-response="onFindScheduleResponse">
        </sc-ajax>

        <!-- 일정 저장 -->
        <sc-ajax id="saveScheduleAjax"
                 url="/bp/cost/ec/detail/saveListSchedule.do"
                 body="{{saveScheduleParam}}"
                 on-response="onSaveScheduleResponse">
        </sc-ajax>

        <!-- 수주결과 조회 -->
        <sc-ajax id="findOrderResultAjax"
                 url="/bp/cost/ec/detail/findOrderResult.do"
                 body="{{detailSearchParam}}"
                 on-response="onFindOrderResultResponse">
        </sc-ajax>

        <!-- 수주결과 저장 -->
        <sc-ajax id="saveOrderResultAjax"
                 url="/bp/cost/ec/detail/saveOrderResult.do"
                 body="{{saveOrderResultParam}}"
                 on-response="onSaveOrderResultResponse">
        </sc-ajax>

        <!-- ============================================================
             조회 조건 영역
             ============================================================ -->
        <sc-search-container on-search="onFindPjtList" auth-code="V">
            <table>
                <colgroup>
                    <col style="width:120px"/><col/>
                    <col style="width:120px"/><col/>
                    <col style="width:120px"/><col/>
                </colgroup>
                <tr>
                    <th><sc-label text="프로젝트 코드"></sc-label></th>
                    <td>
                        <sc-text-field value="{{searchParam.pjtCd}}" on-enter="onFindPjtList"></sc-text-field>
                    </td>
                    <th><sc-label text="사업부"></sc-label></th>
                    <td>
                        <sc-combobox-field value="{{searchParam.bizUnit}}"
                                          items="{{codes.bizUnitList}}"
                                          display-field="label"
                                          value-field="data"
                                          placeholder="전체">
                        </sc-combobox-field>
                    </td>
                    <th><sc-label text="고객사"></sc-label></th>
                    <td>
                        <sc-text-field value="{{searchParam.custNm}}"></sc-text-field>
                    </td>
                </tr>
            </table>
        </sc-search-container>

        <!-- ============================================================
             좌우 Split 레이아웃
             ============================================================ -->
        <div class="hbox flex">

            <!-- ========== 좌측: 프로젝트 목록 그리드 (flex-3) ========== -->
            <sc-grid id="pjtGridPanel"
                     data-provider="{{pjtList}}"
                     on-item-click="onProjectClick"
                     class="flex-3"
                     use-state="false">

                <sc-grid-columns>
                    <sc-data-column data-field="pjtCd"
                                    header-text="프로젝트코드"
                                    width="130"
                                    text-align="center">
                    </sc-data-column>

                    <sc-data-column data-field="pjtNm"
                                    header-text="프로젝트명"
                                    width="180"
                                    text-align="left">
                    </sc-data-column>

                    <sc-data-column data-field="bizUnitNm"
                                    header-text="사업부"
                                    width="80"
                                    text-align="center">
                    </sc-data-column>

                    <sc-data-column data-field="custNm"
                                    header-text="고객사"
                                    width="120">
                    </sc-data-column>

                    <sc-data-column data-field="stsNm"
                                    header-text="상태"
                                    width="80"
                                    text-align="center">
                    </sc-data-column>
                </sc-grid-columns>
            </sc-grid>

            <div class="hspace-10"></div>

            <!-- ========== 우측: 탭 상세 영역 (flex-7) ========== -->
            <div class="vbox flex-7">

                <!-- 탭 버튼 바 -->
                <div class="tab-bar">
                    <button class$="tab-btn {{_activeTab(activeTab,'detail')}}"
                            on-click="_setTab" data-tab="detail">상세정보</button>
                    <button class$="tab-btn {{_activeTab(activeTab,'costCode')}}"
                            on-click="_setTab" data-tab="costCode">원가코드/판가</button>
                    <button class$="tab-btn {{_activeTab(activeTab,'qtyDisc')}}"
                            on-click="_setTab" data-tab="qtyDisc">수량/할인율</button>
                    <button class$="tab-btn {{_activeTab(activeTab,'manager')}}"
                            on-click="_setTab" data-tab="manager">담당자</button>
                    <button class$="tab-btn {{_activeTab(activeTab,'schedule')}}"
                            on-click="_setTab" data-tab="schedule">일정</button>
                    <button class$="tab-btn {{_activeTab(activeTab,'orderResult')}}"
                            on-click="_setTab" data-tab="orderResult">수주결과</button>
                </div>

                <!-- 탭 콘텐츠 영역 -->
                <div style="flex:1; overflow:auto;">

                    <!-- ======================================================
                         TAB 1: 상세정보
                         ====================================================== -->
                    <template is="dom-if" if="{{_isTab(activeTab,'detail')}}">
                        <sc-toolbar>
                            <sc-button text="저장" on-click="onSaveDetail" auth-code="S"></sc-button>
                        </sc-toolbar>

                        <div class="section-title">견적정보 상세</div>
                        <table class="detail-form-table">
                            <colgroup>
                                <col style="width:130px"/><col/>
                                <col style="width:130px"/><col/>
                            </colgroup>
                            <tr>
                                <th><sc-label text="견적접수일"></sc-label></th>
                                <td>
                                    <sc-date-field value="{{detailData.estmRcvDt}}"></sc-date-field>
                                </td>
                                <th><sc-label text="견적제출일"></sc-label></th>
                                <td>
                                    <sc-date-field value="{{detailData.estmSubmitDt}}"></sc-date-field>
                                </td>
                            </tr>
                            <tr>
                                <th><sc-label text="가격경쟁력"></sc-label></th>
                                <td>
                                    <sc-combobox-field value="{{detailData.priceCompetition}}"
                                                      items="{{codes.priceCompList}}"
                                                      display-field="label"
                                                      value-field="data">
                                    </sc-combobox-field>
                                </td>
                                <th><sc-label text="수주유형"></sc-label></th>
                                <td>
                                    <sc-combobox-field value="{{detailData.orderType}}"
                                                      items="{{codes.orderTypeList}}"
                                                      display-field="label"
                                                      value-field="data">
                                    </sc-combobox-field>
                                </td>
                            </tr>
                            <tr>
                                <th><sc-label text="공장구분"></sc-label></th>
                                <td>
                                    <sc-combobox-field value="{{detailData.factoryDiv}}"
                                                      items="{{codes.factoryDivList}}"
                                                      display-field="label"
                                                      value-field="data">
                                    </sc-combobox-field>
                                </td>
                                <th><sc-label text="법인구분"></sc-label></th>
                                <td>
                                    <sc-combobox-field value="{{detailData.corpDiv}}"
                                                      items="{{codes.corpDivList}}"
                                                      display-field="label"
                                                      value-field="data">
                                    </sc-combobox-field>
                                </td>
                            </tr>
                            <tr>
                                <th><sc-label text="수주가능성"></sc-label></th>
                                <td>
                                    <sc-combobox-field value="{{detailData.orderPossibility}}"
                                                      items="{{codes.orderPossibilityList}}"
                                                      display-field="label"
                                                      value-field="data">
                                    </sc-combobox-field>
                                </td>
                                <th><sc-label text="경쟁업체"></sc-label></th>
                                <td>
                                    <sc-text-field value="{{detailData.competitor}}"></sc-text-field>
                                </td>
                            </tr>
                            <tr>
                                <th><sc-label text="개발가능성"></sc-label></th>
                                <td>
                                    <sc-combobox-field value="{{detailData.devPossibility}}"
                                                      items="{{codes.devPossibilityList}}"
                                                      display-field="label"
                                                      value-field="data">
                                    </sc-combobox-field>
                                </td>
                                <td colspan="2"></td>
                            </tr>
                        </table>
                    </template>

                    <!-- ======================================================
                         TAB 2: 원가코드/판가
                         ====================================================== -->
                    <template is="dom-if" if="{{_isTab(activeTab,'costCode')}}">
                        <sc-grid id="costCodeGrid"
                                 data-provider="{{costCodeList}}"
                                 editable="true"
                                 class="flex">

                            <sc-toolbar>
                                <sc-button text="행추가" on-click="onAddCostCodeRow" auth-code="S"></sc-button>
                                <sc-button text="삭제"   on-click="onDeleteCostCodeRow" auth-code="S"></sc-button>
                                <sc-button text="저장"   on-click="onSaveCostCode" auth-code="S"></sc-button>
                            </sc-toolbar>

                            <sc-grid-columns>
                                <sc-data-column data-field="seqNo"
                                                header-text="순번"
                                                width="60"
                                                text-align="center"
                                                editable="false">
                                </sc-data-column>

                                <sc-combobox-column data-field="prodGrp"
                                                   header-text="제품군"
                                                   width="120"
                                                   editable="true"
                                                   items="{{codes.prodGrpList}}"
                                                   display-field="label"
                                                   value-field="data">
                                </sc-combobox-column>

                                <sc-data-column data-field="costGrp"
                                                header-text="원가그룹"
                                                width="120"
                                                editable="true">
                                </sc-data-column>

                                <sc-data-column data-field="costCd"
                                                header-text="원가코드"
                                                width="120"
                                                editable="true"
                                                required="true">
                                </sc-data-column>

                                <sc-combobox-column data-field="estmCurrency"
                                                   header-text="견적통화"
                                                   width="100"
                                                   editable="true"
                                                   items="{{codes.currencyList}}"
                                                   display-field="label"
                                                   value-field="data">
                                </sc-combobox-column>

                                <sc-data-column data-field="estmSellingPrice"
                                                header-text="견적판가"
                                                width="120"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,###.##">
                                </sc-data-column>

                                <sc-data-column data-field="sopDt"
                                                header-text="SOP"
                                                width="100"
                                                editable="true"
                                                text-align="center">
                                </sc-data-column>

                                <sc-data-column data-field="eopDt"
                                                header-text="EOP"
                                                width="100"
                                                editable="true"
                                                text-align="center">
                                </sc-data-column>
                            </sc-grid-columns>

                            <sc-grid-fields>
                                <sc-grid-field data-field="ecPjtCd"></sc-grid-field>
                                <sc-grid-field data-field="costCodeSeq"></sc-grid-field>
                            </sc-grid-fields>
                        </sc-grid>
                    </template>

                    <!-- ======================================================
                         TAB 3: 수량/할인율
                         ====================================================== -->
                    <template is="dom-if" if="{{_isTab(activeTab,'qtyDisc')}}">
                        <sc-grid id="qtyDiscGrid"
                                 data-provider="{{qtyDiscList}}"
                                 editable="true"
                                 class="flex">

                            <sc-toolbar>
                                <sc-button text="행추가" on-click="onAddQtyDiscRow" auth-code="S"></sc-button>
                                <sc-button text="삭제"   on-click="onDeleteQtyDiscRow" auth-code="S"></sc-button>
                                <sc-button text="저장"   on-click="onSaveQtyDisc" auth-code="S"></sc-button>
                            </sc-toolbar>

                            <sc-grid-columns>
                                <sc-data-column data-field="costCd"
                                                header-text="원가코드"
                                                width="120"
                                                editable="false"
                                                text-align="center">
                                </sc-data-column>

                                <sc-data-column data-field="yr1Qty"
                                                header-text="1차년도 수량"
                                                width="110"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,###">
                                </sc-data-column>

                                <sc-data-column data-field="yr2Qty"
                                                header-text="2차년도 수량"
                                                width="110"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,###">
                                </sc-data-column>

                                <sc-data-column data-field="yr3Qty"
                                                header-text="3차년도 수량"
                                                width="110"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,###">
                                </sc-data-column>

                                <sc-data-column data-field="yr4Qty"
                                                header-text="4차년도 수량"
                                                width="110"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,###">
                                </sc-data-column>

                                <sc-data-column data-field="yr5Qty"
                                                header-text="5차년도 수량"
                                                width="110"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,###">
                                </sc-data-column>

                                <sc-data-column data-field="yr1DiscRate"
                                                header-text="1차년도 할인율(%)"
                                                width="130"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,##0.0">
                                </sc-data-column>

                                <sc-data-column data-field="yr2DiscRate"
                                                header-text="2차년도 할인율(%)"
                                                width="130"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,##0.0">
                                </sc-data-column>

                                <sc-data-column data-field="yr3DiscRate"
                                                header-text="3차년도 할인율(%)"
                                                width="130"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,##0.0">
                                </sc-data-column>

                                <sc-data-column data-field="yr4DiscRate"
                                                header-text="4차년도 할인율(%)"
                                                width="130"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,##0.0">
                                </sc-data-column>

                                <sc-data-column data-field="yr5DiscRate"
                                                header-text="5차년도 할인율(%)"
                                                width="130"
                                                editable="true"
                                                text-align="right"
                                                data-type="number"
                                                format="#,##0.0">
                                </sc-data-column>
                            </sc-grid-columns>

                            <sc-grid-fields>
                                <sc-grid-field data-field="ecPjtCd"></sc-grid-field>
                                <sc-grid-field data-field="qtyDiscSeq"></sc-grid-field>
                            </sc-grid-fields>
                        </sc-grid>
                    </template>

                    <!-- ======================================================
                         TAB 4: 담당자
                         ====================================================== -->
                    <template is="dom-if" if="{{_isTab(activeTab,'manager')}}">
                        <sc-grid id="managerGrid"
                                 data-provider="{{managerList}}"
                                 editable="true"
                                 class="flex">

                            <sc-toolbar>
                                <sc-button text="행추가" on-click="onAddManagerRow" auth-code="S"></sc-button>
                                <sc-button text="삭제"   on-click="onDeleteManagerRow" auth-code="S"></sc-button>
                                <sc-button text="저장"   on-click="onSaveManager" auth-code="S"></sc-button>
                            </sc-toolbar>

                            <sc-grid-columns>
                                <sc-combobox-column data-field="deptDiv"
                                                   header-text="부서구분"
                                                   width="120"
                                                   editable="true"
                                                   items="{{codes.deptDivList}}"
                                                   display-field="label"
                                                   value-field="data">
                                </sc-combobox-column>

                                <sc-data-column data-field="userId"
                                                header-text="아이디"
                                                width="120"
                                                editable="true"
                                                required="true">
                                </sc-data-column>

                                <sc-data-column data-field="userNm"
                                                header-text="이름"
                                                width="100"
                                                editable="true"
                                                required="true">
                                </sc-data-column>

                                <sc-combobox-column data-field="role"
                                                   header-text="Role"
                                                   width="100"
                                                   editable="true"
                                                   items="{{codes.roleList}}"
                                                   display-field="label"
                                                   value-field="data">
                                </sc-combobox-column>

                                <sc-data-column data-field="email"
                                                header-text="E-mail"
                                                width="200"
                                                editable="true">
                                </sc-data-column>
                            </sc-grid-columns>

                            <sc-grid-fields>
                                <sc-grid-field data-field="ecPjtCd"></sc-grid-field>
                                <sc-grid-field data-field="managerSeq"></sc-grid-field>
                            </sc-grid-fields>
                        </sc-grid>
                    </template>

                    <!-- ======================================================
                         TAB 5: 일정
                         ====================================================== -->
                    <template is="dom-if" if="{{_isTab(activeTab,'schedule')}}">
                        <sc-grid id="scheduleGrid"
                                 data-provider="{{scheduleList}}"
                                 editable="true"
                                 class="flex">

                            <sc-toolbar>
                                <sc-button text="행추가" on-click="onAddScheduleRow" auth-code="S"></sc-button>
                                <sc-button text="삭제"   on-click="onDeleteScheduleRow" auth-code="S"></sc-button>
                                <sc-button text="저장"   on-click="onSaveSchedule" auth-code="S"></sc-button>
                            </sc-toolbar>

                            <sc-grid-columns>
                                <sc-combobox-column data-field="taskDiv"
                                                   header-text="업무구분"
                                                   width="150"
                                                   editable="true"
                                                   items="{{codes.taskDivList}}"
                                                   display-field="label"
                                                   value-field="data"
                                                   required="true">
                                </sc-combobox-column>

                                <sc-data-column data-field="startDt"
                                                header-text="시작일"
                                                width="120"
                                                editable="true"
                                                text-align="center">
                                </sc-data-column>

                                <sc-data-column data-field="endDt"
                                                header-text="종료일"
                                                width="120"
                                                editable="true"
                                                text-align="center">
                                </sc-data-column>

                                <sc-data-column data-field="actualEndDt"
                                                header-text="실제종료일"
                                                width="120"
                                                editable="true"
                                                text-align="center">
                                </sc-data-column>

                                <sc-data-column data-field="delayDays"
                                                header-text="지연일"
                                                width="80"
                                                editable="false"
                                                text-align="right"
                                                data-type="number">
                                </sc-data-column>
                            </sc-grid-columns>

                            <sc-grid-fields>
                                <sc-grid-field data-field="ecPjtCd"></sc-grid-field>
                                <sc-grid-field data-field="scheduleSeq"></sc-grid-field>
                            </sc-grid-fields>
                        </sc-grid>
                    </template>

                    <!-- ======================================================
                         TAB 6: 수주결과
                         ====================================================== -->
                    <template is="dom-if" if="{{_isTab(activeTab,'orderResult')}}">
                        <sc-toolbar>
                            <sc-button text="저장" on-click="onSaveOrderResult" auth-code="S"></sc-button>
                        </sc-toolbar>

                        <div class="section-title">수주결과 정보</div>
                        <table class="detail-form-table">
                            <colgroup>
                                <col style="width:130px"/><col/>
                            </colgroup>
                            <tr>
                                <th><sc-label text="수주결과"></sc-label></th>
                                <td>
                                    <sc-combobox-field value="{{orderResult.orderResultCd}}"
                                                      items="{{codes.orderResultList}}"
                                                      display-field="label"
                                                      value-field="data">
                                    </sc-combobox-field>
                                </td>
                            </tr>
                            <tr>
                                <th><sc-label text="결과비고"></sc-label></th>
                                <td>
                                    <sc-text-field value="{{orderResult.resultRemark}}"
                                                   placeholder="수주결과에 대한 비고를 입력하세요."
                                                   multi-line="true"
                                                   rows="4">
                                    </sc-text-field>
                                </td>
                            </tr>
                        </table>
                    </template>

                </div><!-- /탭 콘텐츠 영역 -->
            </div><!-- /우측 -->
        </div><!-- /좌우 Split -->
    </template>

    <script>
        Polymer({
            is: 'es-ec-detail',

            properties: {
                /* ─── 조회 조건 ─── */
                searchParam: {
                    type: Object,
                    value: function() { return {}; }
                },

                /* ─── 좌측 프로젝트 목록 ─── */
                pjtList: {
                    type: Array,
                    value: function() { return []; }
                },

                /* ─── 선택된 프로젝트 ─── */
                selectedPjt: {
                    type: Object,
                    value: function() { return {}; }
                },

                /* ─── 활성 탭 ─── */
                activeTab: {
                    type: String,
                    value: 'detail'
                },

                /* ─── TAB 1: 상세정보 ─── */
                detailData: {
                    type: Object,
                    value: function() { return {}; }
                },

                /* ─── TAB 2: 원가코드/판가 ─── */
                costCodeList: {
                    type: Array,
                    value: function() { return []; }
                },

                /* ─── TAB 3: 수량/할인율 ─── */
                qtyDiscList: {
                    type: Array,
                    value: function() { return []; }
                },

                /* ─── TAB 4: 담당자 ─── */
                managerList: {
                    type: Array,
                    value: function() { return []; }
                },

                /* ─── TAB 5: 일정 ─── */
                scheduleList: {
                    type: Array,
                    value: function() { return []; }
                },

                /* ─── TAB 6: 수주결과 ─── */
                orderResult: {
                    type: Object,
                    value: function() { return {}; }
                },

                /* ─── Ajax 파라미터 ─── */
                detailSearchParam:   { type: Object, value: function() { return {}; } },
                saveDetailParam:     { type: Object, value: function() { return {}; } },
                saveCostCodeParam:   { type: Object, value: function() { return {}; } },
                saveQtyDiscParam:    { type: Object, value: function() { return {}; } },
                saveManagerParam:    { type: Object, value: function() { return {}; } },
                saveScheduleParam:   { type: Object, value: function() { return {}; } },
                saveOrderResultParam:{ type: Object, value: function() { return {}; } },

                /* ─── 공통코드 ─── */
                codes: {
                    type: Object,
                    value: function() {
                        return {
                            bizUnitList: [
                                { label: 'PT',   data: 'PT' },
                                { label: 'SEAT', data: 'SEAT' }
                            ],
                            priceCompList: [
                                { label: '상', data: 'H' },
                                { label: '중', data: 'M' },
                                { label: '하', data: 'L' }
                            ],
                            orderTypeList: [
                                { label: '신규수주',   data: 'NEW' },
                                { label: '기존확대',   data: 'EXT' },
                                { label: '대체수주',   data: 'REP' }
                            ],
                            factoryDivList: [
                                { label: '본사공장', data: 'HQ' },
                                { label: '제2공장',  data: 'F2' },
                                { label: '해외공장', data: 'OV' }
                            ],
                            corpDivList: [
                                { label: '본사',   data: 'HQ' },
                                { label: '해외법인', data: 'OV' }
                            ],
                            orderPossibilityList: [
                                { label: '상', data: 'H' },
                                { label: '중', data: 'M' },
                                { label: '하', data: 'L' }
                            ],
                            devPossibilityList: [
                                { label: '상', data: 'H' },
                                { label: '중', data: 'M' },
                                { label: '하', data: 'L' }
                            ],
                            prodGrpList: [
                                { label: 'T/M',  data: 'TM' },
                                { label: 'AXLE', data: 'AXLE' },
                                { label: 'SEAT', data: 'SEAT' }
                            ],
                            currencyList: [
                                { label: 'KRW', data: 'KRW' },
                                { label: 'USD', data: 'USD' },
                                { label: 'EUR', data: 'EUR' },
                                { label: 'JPY', data: 'JPY' },
                                { label: 'CNY', data: 'CNY' }
                            ],
                            deptDivList: [
                                { label: '영업',   data: 'SALES' },
                                { label: '설계',   data: 'DESIGN' },
                                { label: '원가',   data: 'COST' },
                                { label: '품질',   data: 'QA' },
                                { label: '생산',   data: 'PROD' }
                            ],
                            roleList: [
                                { label: 'PM', data: 'PM' },
                                { label: 'PL', data: 'PL' }
                            ],
                            taskDivList: [
                                { label: '견적접수',   data: 'RCV' },
                                { label: '원가산출',   data: 'CALC' },
                                { label: '견적검토',   data: 'REVIEW' },
                                { label: '견적제출',   data: 'SUBMIT' },
                                { label: '수주확정',   data: 'CONFIRM' }
                            ],
                            orderResultList: [
                                { label: '수주',     data: 'WIN' },
                                { label: '실주',     data: 'LOSE' },
                                { label: '보류',     data: 'HOLD' },
                                { label: '취소',     data: 'CANCEL' }
                            ]
                        };
                    }
                }
            },

            /* ==============================================================
               탭 제어 헬퍼
               ============================================================== */

            /**
             * 탭 버튼 활성 클래스 계산
             */
            _activeTab: function(activeTab, tabName) {
                return activeTab === tabName ? 'active' : '';
            },

            /**
             * 현재 탭 여부 판별 (dom-if 조건)
             */
            _isTab: function(activeTab, tabName) {
                return activeTab === tabName;
            },

            /**
             * 탭 버튼 클릭 핸들러
             */
            _setTab: function(e) {
                var tabName = e.currentTarget.getAttribute('data-tab');
                this.set('activeTab', tabName);
                this._loadTabData(tabName);
            },

            /**
             * 탭 전환 시 해당 탭 데이터 로드
             */
            _loadTabData: function(tabName) {
                if (!this.selectedPjt || !this.selectedPjt.pjtCd) return;

                switch (tabName) {
                    case 'detail':
                        this.$.findDetailAjax.generateRequest();
                        break;
                    case 'costCode':
                        this.$.findCostCodeAjax.generateRequest();
                        break;
                    case 'qtyDisc':
                        this.$.findQtyDiscAjax.generateRequest();
                        break;
                    case 'manager':
                        this.$.findManagerAjax.generateRequest();
                        break;
                    case 'schedule':
                        this.$.findScheduleAjax.generateRequest();
                        break;
                    case 'orderResult':
                        this.$.findOrderResultAjax.generateRequest();
                        break;
                }
            },

            /* ==============================================================
               프로젝트 목록 조회 (좌측 그리드)
               ============================================================== */

            onFindPjtList: function() {
                this.$.findPjtListAjax.generateRequest();
            },

            onFindPjtListResponse: function(e) {
                this.set('pjtList', e.detail.response);
            },

            /* ==============================================================
               프로젝트 선택 -> 우측 상세 로드
               ============================================================== */

            onProjectClick: function(e) {
                var row = e.detail.data;
                if (!row || !row.pjtCd) return;

                this.set('selectedPjt', row);
                this.set('detailSearchParam', { ecPjtCd: row.pjtCd });

                // 현재 활성 탭의 데이터 로드
                this._loadTabData(this.activeTab);
            },

            /* ==============================================================
               TAB 1: 상세정보 — 조회 / 저장
               ============================================================== */

            onFindDetailResponse: function(e) {
                var data = e.detail.response;
                if (data && data.ecPjtCd) {
                    this.set('detailData', data);
                } else {
                    this.set('detailData', {
                        ecPjtCd:          this.selectedPjt.pjtCd,
                        estmRcvDt:        '',
                        estmSubmitDt:     '',
                        priceCompetition: '',
                        orderType:        '',
                        factoryDiv:       '',
                        corpDiv:          '',
                        orderPossibility: '',
                        competitor:       '',
                        devPossibility:   ''
                    });
                }
            },

            onSaveDetail: function() {
                if (!this.selectedPjt || !this.selectedPjt.pjtCd) {
                    UT.alert('좌측 그리드에서 프로젝트를 선택해 주세요.');
                    return;
                }
                var me = this;
                UT.confirm('MSG_COM_00002', function() {
                    me.detailData.ecPjtCd = me.selectedPjt.pjtCd;
                    me.set('saveDetailParam', me.detailData);
                    me.$.saveDetailAjax.generateRequest();
                });
            },

            onSaveDetailResponse: function() {
                UT.alert('MSG_COM_00003');
            },

            /* ==============================================================
               TAB 2: 원가코드/판가 — 조회 / 행추가 / 삭제 / 저장
               ============================================================== */

            onFindCostCodeResponse: function(e) {
                this.set('costCodeList', e.detail.response || []);
            },

            onAddCostCodeRow: function() {
                var grid = this.$['costCodeGrid'] || this.$$('#costCodeGrid');
                if (!grid) return;

                var seqNo = (this.costCodeList ? this.costCodeList.length : 0) + 1;
                grid.insertRow(0, {
                    ecPjtCd:          this.selectedPjt.pjtCd,
                    seqNo:            seqNo,
                    prodGrp:          '',
                    costGrp:          '',
                    costCd:           '',
                    estmCurrency:     'KRW',
                    estmSellingPrice: 0,
                    sopDt:            '',
                    eopDt:            ''
                });
            },

            onDeleteCostCodeRow: function() {
                var grid = this.$['costCodeGrid'] || this.$$('#costCodeGrid');
                if (!grid) return;

                var selectedRows = grid.getSelectedRows();
                if (!selectedRows || selectedRows.length === 0) {
                    UT.alert('MSG_COM_00007');
                    return;
                }
                grid.removeRows(selectedRows);
            },

            onSaveCostCode: function() {
                if (!this.selectedPjt || !this.selectedPjt.pjtCd) {
                    UT.alert('좌측 그리드에서 프로젝트를 선택해 주세요.');
                    return;
                }
                var grid = this.$['costCodeGrid'] || this.$$('#costCodeGrid');
                if (!grid) return;

                var modifiedRows = grid.getModifiedRows();
                if (!modifiedRows || modifiedRows.length === 0) {
                    UT.alert('MSG_COM_00006');
                    return;
                }

                var me = this;
                UT.confirm('MSG_COM_00002', function() {
                    me.set('saveCostCodeParam', {
                        ecPjtCd:  me.selectedPjt.pjtCd,
                        saveList: modifiedRows
                    });
                    me.$.saveCostCodeAjax.generateRequest();
                });
            },

            onSaveCostCodeResponse: function() {
                UT.alert('MSG_COM_00003');
                this._loadTabData('costCode');
            },

            /* ==============================================================
               TAB 3: 수량/할인율 — 조회 / 행추가 / 삭제 / 저장
               ============================================================== */

            onFindQtyDiscResponse: function(e) {
                this.set('qtyDiscList', e.detail.response || []);
            },

            onAddQtyDiscRow: function() {
                var grid = this.$['qtyDiscGrid'] || this.$$('#qtyDiscGrid');
                if (!grid) return;

                grid.insertRow(0, {
                    ecPjtCd:    this.selectedPjt.pjtCd,
                    costCd:     '',
                    yr1Qty: 0, yr2Qty: 0, yr3Qty: 0, yr4Qty: 0, yr5Qty: 0,
                    yr1DiscRate: 0, yr2DiscRate: 0, yr3DiscRate: 0, yr4DiscRate: 0, yr5DiscRate: 0
                });
            },

            onDeleteQtyDiscRow: function() {
                var grid = this.$['qtyDiscGrid'] || this.$$('#qtyDiscGrid');
                if (!grid) return;

                var selectedRows = grid.getSelectedRows();
                if (!selectedRows || selectedRows.length === 0) {
                    UT.alert('MSG_COM_00007');
                    return;
                }
                grid.removeRows(selectedRows);
            },

            onSaveQtyDisc: function() {
                if (!this.selectedPjt || !this.selectedPjt.pjtCd) {
                    UT.alert('좌측 그리드에서 프로젝트를 선택해 주세요.');
                    return;
                }
                var grid = this.$['qtyDiscGrid'] || this.$$('#qtyDiscGrid');
                if (!grid) return;

                var modifiedRows = grid.getModifiedRows();
                if (!modifiedRows || modifiedRows.length === 0) {
                    UT.alert('MSG_COM_00006');
                    return;
                }

                var me = this;
                UT.confirm('MSG_COM_00002', function() {
                    me.set('saveQtyDiscParam', {
                        ecPjtCd:  me.selectedPjt.pjtCd,
                        saveList: modifiedRows
                    });
                    me.$.saveQtyDiscAjax.generateRequest();
                });
            },

            onSaveQtyDiscResponse: function() {
                UT.alert('MSG_COM_00003');
                this._loadTabData('qtyDisc');
            },

            /* ==============================================================
               TAB 4: 담당자 — 조회 / 행추가 / 삭제 / 저장
               ============================================================== */

            onFindManagerResponse: function(e) {
                this.set('managerList', e.detail.response || []);
            },

            onAddManagerRow: function() {
                var grid = this.$['managerGrid'] || this.$$('#managerGrid');
                if (!grid) return;

                grid.insertRow(0, {
                    ecPjtCd: this.selectedPjt.pjtCd,
                    deptDiv: '',
                    userId:  '',
                    userNm:  '',
                    role:    '',
                    email:   ''
                });
            },

            onDeleteManagerRow: function() {
                var grid = this.$['managerGrid'] || this.$$('#managerGrid');
                if (!grid) return;

                var selectedRows = grid.getSelectedRows();
                if (!selectedRows || selectedRows.length === 0) {
                    UT.alert('MSG_COM_00007');
                    return;
                }
                grid.removeRows(selectedRows);
            },

            onSaveManager: function() {
                if (!this.selectedPjt || !this.selectedPjt.pjtCd) {
                    UT.alert('좌측 그리드에서 프로젝트를 선택해 주세요.');
                    return;
                }
                var grid = this.$['managerGrid'] || this.$$('#managerGrid');
                if (!grid) return;

                var modifiedRows = grid.getModifiedRows();
                if (!modifiedRows || modifiedRows.length === 0) {
                    UT.alert('MSG_COM_00006');
                    return;
                }

                // 필수값 검증: 아이디, 이름
                for (var i = 0; i < modifiedRows.length; i++) {
                    if (!modifiedRows[i].userId || !modifiedRows[i].userNm) {
                        UT.alert('MSG_COM_00001');
                        return;
                    }
                }

                var me = this;
                UT.confirm('MSG_COM_00002', function() {
                    me.set('saveManagerParam', {
                        ecPjtCd:  me.selectedPjt.pjtCd,
                        saveList: modifiedRows
                    });
                    me.$.saveManagerAjax.generateRequest();
                });
            },

            onSaveManagerResponse: function() {
                UT.alert('MSG_COM_00003');
                this._loadTabData('manager');
            },

            /* ==============================================================
               TAB 5: 일정 — 조회 / 행추가 / 삭제 / 저장
               ============================================================== */

            onFindScheduleResponse: function(e) {
                this.set('scheduleList', e.detail.response || []);
            },

            onAddScheduleRow: function() {
                var grid = this.$['scheduleGrid'] || this.$$('#scheduleGrid');
                if (!grid) return;

                grid.insertRow(0, {
                    ecPjtCd:     this.selectedPjt.pjtCd,
                    taskDiv:     '',
                    startDt:     '',
                    endDt:       '',
                    actualEndDt: '',
                    delayDays:   0
                });
            },

            onDeleteScheduleRow: function() {
                var grid = this.$['scheduleGrid'] || this.$$('#scheduleGrid');
                if (!grid) return;

                var selectedRows = grid.getSelectedRows();
                if (!selectedRows || selectedRows.length === 0) {
                    UT.alert('MSG_COM_00007');
                    return;
                }
                grid.removeRows(selectedRows);
            },

            onSaveSchedule: function() {
                if (!this.selectedPjt || !this.selectedPjt.pjtCd) {
                    UT.alert('좌측 그리드에서 프로젝트를 선택해 주세요.');
                    return;
                }
                var grid = this.$['scheduleGrid'] || this.$$('#scheduleGrid');
                if (!grid) return;

                var modifiedRows = grid.getModifiedRows();
                if (!modifiedRows || modifiedRows.length === 0) {
                    UT.alert('MSG_COM_00006');
                    return;
                }

                var me = this;
                UT.confirm('MSG_COM_00002', function() {
                    me.set('saveScheduleParam', {
                        ecPjtCd:  me.selectedPjt.pjtCd,
                        saveList: modifiedRows
                    });
                    me.$.saveScheduleAjax.generateRequest();
                });
            },

            onSaveScheduleResponse: function() {
                UT.alert('MSG_COM_00003');
                this._loadTabData('schedule');
            },

            /* ==============================================================
               TAB 6: 수주결과 — 조회 / 저장
               ============================================================== */

            onFindOrderResultResponse: function(e) {
                var data = e.detail.response;
                if (data && data.ecPjtCd) {
                    this.set('orderResult', data);
                } else {
                    this.set('orderResult', {
                        ecPjtCd:       this.selectedPjt.pjtCd,
                        orderResultCd: '',
                        resultRemark:  ''
                    });
                }
            },

            onSaveOrderResult: function() {
                if (!this.selectedPjt || !this.selectedPjt.pjtCd) {
                    UT.alert('좌측 그리드에서 프로젝트를 선택해 주세요.');
                    return;
                }
                var me = this;
                UT.confirm('MSG_COM_00002', function() {
                    me.orderResult.ecPjtCd = me.selectedPjt.pjtCd;
                    me.set('saveOrderResultParam', me.orderResult);
                    me.$.saveOrderResultAjax.generateRequest();
                });
            },

            onSaveOrderResultResponse: function() {
                UT.alert('MSG_COM_00003');
            }
        });
    </script>
</dom-module>
